{% extends "crm/base.html" %}

{% block content %}
<h1>Мои Задачи</h1>

<button id='open-form-btn'>Добавить задачу</button>

<div id='task-form' style='display: none;'>
	<form hx-post="{% url 'create_task' %}" hx-target='#task-list' hx-swap='beforeend'>
		{% csrf_token %}
		{{ form.as_p }}
		<button type='submit'>Сохранить</button>
	</form>
</div>

<ul id='task-list'>
	{% for task in tasks %}
		{% include 'crm/task_item.html' %}
	{% endfor %}	
</ul>

<script>
	document.getElementById('open-form-btn').addEventListener('click', function() {
			var form = document.getElementById('task-form');
			form.style.display = form.style.display === 'none' ? 'block' : 'none';
	});

	document.body.addEventListener("htmx:afterRequest", function(event) {
			if (event.detail.successful) {
					let formContainer = document.getElementById("task-form");  
					let formElement = document.getElementById("task-form-element");  

					if (formElement) {
							formElement.reset(); 
					}
					if (formContainer) {
							formContainer.style.display = "none"; 
					}
			}
	});
</script>

{% endblock content %}